---
layout: post
category: DDIA
---

## TOC

现在很多应用都是数据密集型应用(data-intensive)，而不是计算密集型应用(compute-intensive)

数据密集型应用的标准组件及其通用功能：
- 存储数据（database）
- 加快读取速度(cache)
- 按关键词搜索数据，或对数据进行过滤(search indexes)
- 向其他进程发送消息，进行异步处理(stream processing)
- 定期处理大批量数据(batch processing)

基础目标：
- 可靠性(Reliability)
- 可扩展性(Scalability)
- 可维护性(Maintainability)

## 可靠性

**系统在困境中仍可以正常工作**

故障(fault)：造成错误的原因,通常定义为系统的一部分状态偏离其标准

容错(fault-tolerant)：能**预料**并应对故障的系统特性

失效(failure): 系统作为一个整体停止向用户提供服务。

硬件故障的解决方式：增加单个硬件的冗余度、软件容错机制

软件错误：内部的系统性错误(systematic error)，比如失控进程占用共享资源等，还有比如级联故障等。解决方法：仔细考虑假设和交互，测试，进程隔离，测量监控等等……

人为错误：运维配置错误是导致服务中断的首要原因。解决方法：以最小化犯错机会的方式设计系统（比如抽象、设计api等等），将人们最容易犯错的地方和可能导致失效的地方解耦(decouple)，提供一个功能齐全的非生产环境沙箱(sandbox)，在各个层次进行彻底的测试，允许从人为错误中简单快速地恢复，配置详细和明确的监控，良好的管理实践与充分的培训。

## 可扩展性

“如果系统以特定方式增长，有什么选项可以应对增长？”

“如何增加计算资源来处理额外的负载？”

### 描述负载

负载参数的最佳选择取决于系统架构，可能是每秒向web服务器发出的请求、数据库中的读写比率、聊天室中同时活跃的用户数量、缓存命中率或其他东西

#### 推特的例子

推特发布推文：用户可以向其粉丝发布新消息（平均 4.6k请求/秒，峰值超过 12k请求/秒）。

主页时间线：用户可以查阅他们关注的人发布的推文（300k请求/秒）。

处理每秒12,000次写入（发推文的速率峰值）还是很简单的。然而推特的扩展性挑战并不是主要来自推特量，而是来自扇出（fan-out）——每个用户关注了很多人，也被很多人关注。

有两种实现方式。

##### 方式1

发布推文时，只需要将新推文推入全局推文集合即可，当请求自己的主页时间线时，首先查找他关注的所有人，查询这些被关注用户发布的推文并按时间顺序合并。

![](/home/jeremy/blog/Jeremy0953.github.io/pictures/2021-10-08 12-10-42 的屏幕截图.png)

